<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Work & Study</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif; background: #1a1a1a; color: #e0e0e0; }
    
    .top-nav { background: #161616; padding: 10px 20px; display: flex; gap: 15px; border-bottom: 1px solid #333; }
    .top-nav a { color: #888; text-decoration: none; padding: 8px 16px; border-radius: 6px; transition: all 0.2s; }
    .top-nav a:hover { background: #2a2a2a; color: #4a9eff; }
    .top-nav a.active { background: #2a2a2a; color: #4a9eff; }
    
    .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
    header { background: #222; padding: 15px 20px; margin-bottom: 20px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px; }
    header h1 { font-size: 24px; }
    
    .btn { background: #4a9eff; color: #fff; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 14px; margin: 5px; transition: background 0.2s; }
    .btn:hover { background: #3a8eef; }
    .btn-sm { padding: 6px 12px; font-size: 12px; }
    .btn-ghost { background: transparent; border: 1px solid #4a9eff; }
    
    .tabs { display: flex; gap: 5px; margin-bottom: 20px; background: #2a2a2a; padding: 5px; border-radius: 8px; flex-wrap: wrap; }
    .tabs button { background: transparent; border: none; padding: 10px 20px; color: #bbb; cursor: pointer; border-radius: 6px; font-size: 14px; transition: all 0.2s; }
    .tabs button:hover { background: #333; }
    .tabs button.active { background: #4a9eff; color: #fff; }
    
    .panel { display: none; }
    .panel.active { display: block; }
    
    .grid { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; }
    @media (max-width: 968px) { .grid { grid-template-columns: 1fr; } }
    
    .card { background: #2a2a2a; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.3); margin-bottom: 20px; }
    .card h2 { font-size: 18px; margin-bottom: 15px; color: #fff; border-bottom: 2px solid #444; padding-bottom: 10px; }
    
    .class-item { background: #333; padding: 15px; border-radius: 6px; margin-bottom: 10px; border-left: 4px solid #4a9eff; }
    .class-time { font-weight: 600; color: #4a9eff; font-size: 16px; }
    .class-name { font-size: 18px; margin: 5px 0; color: #fff; }
    .class-location { font-size: 12px; color: #888; }
    .class-notes { margin-top: 10px; }
    .class-notes textarea { background: #2a2a2a; border: 1px solid #444; color: #e0e0e0; padding: 10px; border-radius: 6px; width: 100%; font-size: 14px; min-height: 80px; resize: vertical; }
    
    .task-item { background: #333; padding: 12px; border-radius: 6px; margin-bottom: 8px; display: flex; align-items: center; gap: 10px; cursor: move; }
    .task-item.dragging { opacity: 0.5; }
    .task-item input[type="checkbox"] { width: 18px; height: 18px; cursor: pointer; flex-shrink: 0; }
    .task-item.done { opacity: 0.5; }
    .task-item.done .task-text { text-decoration: line-through; }
    .task-item .drag-handle { color: #666; cursor: grab; flex-shrink: 0; }
    .task-item .drag-handle:active { cursor: grabbing; }
    .task-text { flex: 1; }
    
    .priority-high { border-left: 4px solid #ef4444; }
    .priority-medium { border-left: 4px solid #f59e0b; }
    .priority-low { border-left: 4px solid #10b981; }
    
    .timer-display { text-align: center; padding: 30px; background: #333; border-radius: 8px; }
    .timer-number { font-size: 48px; font-weight: 600; color: #4a9eff; font-family: 'Courier New', monospace; }
    .timer-controls { display: flex; gap: 10px; justify-content: center; margin-top: 20px; flex-wrap: wrap; }
    .timer-presets { display: flex; gap: 5px; justify-content: center; margin-top: 10px; flex-wrap: wrap; }
    
    input, select, textarea { background: #333; border: 1px solid #444; color: #e0e0e0; padding: 10px; border-radius: 6px; width: 100%; margin-bottom: 10px; font-size: 14px; }
    input:focus, select:focus, textarea:focus { outline: none; border-color: #4a9eff; }
    
    .work-log-entry { background: #333; padding: 15px; border-radius: 6px; margin-bottom: 10px; }
    .work-log-header { display: flex; justify-content: space-between; margin-bottom: 10px; align-items: start; }
    .work-log-date { font-weight: 600; }
    .work-log-class { color: #4a9eff; font-size: 14px; }
    .work-log-notes { line-height: 1.6; font-size: 14px; }
    
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center; }
    .modal.open { display: flex; }
    .modal-content { background: #2a2a2a; padding: 30px; border-radius: 12px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto; }
    .modal-content h3 { margin-bottom: 20px; }
    
    .schedule-day { margin-bottom: 15px; }
    .schedule-day h4 { font-size: 14px; color: #999; margin-bottom: 5px; }
  </style>
</head>
<body>

<div class="top-nav">
  <a href="index.html">← Hub</a>
  <a href="walks.html">Walks</a>
  <a href="work.html" class="active">Work</a>
  <a href="business.html">Business</a>
</div>

<header>
  <h1>Work & Study</h1>
  <div>
    <button class="btn btn-ghost" onclick="openModal('scheduleModal')">Edit Schedule</button>
    <button class="btn btn-ghost" onclick="exportData()">Export to Drive</button>
  </div>
</header>

<div class="container">
  <div class="tabs">
    <button class="active" onclick="showTab('today')">Today</button>
    <button onclick="showTab('log')">Work Log</button>
    <button onclick="showTab('tasks')">Tasks</button>
  </div>

  <!-- TODAY Panel -->
  <div id="today" class="panel active">
    <div class="grid">
      <div>
        <div class="card">
          <h2>Today's Classes - <span id="todayDate"></span></h2>
          <div id="todayClasses"></div>
        </div>
      </div>
      
      <div>
        <div class="card">
          <h2>Pomodoro Timer</h2>
          <div class="timer-display">
            <div class="timer-number" id="timerDisplay">25:00</div>
            <div class="timer-controls">
              <button class="btn" id="timerStart" onclick="startTimer()">Start</button>
              <button class="btn btn-ghost" id="timerPause" onclick="pauseTimer()" style="display:none;">Pause</button>
              <button class="btn btn-ghost" onclick="resetTimer()">Reset</button>
            </div>
            <div class="timer-presets">
              <button class="btn btn-sm btn-ghost" onclick="setTimer(25)">25m</button>
              <button class="btn btn-sm btn-ghost" onclick="setTimer(15)">15m</button>
              <button class="btn btn-sm btn-ghost" onclick="setTimer(5)">5m</button>
              <button class="btn btn-sm btn-ghost" onclick="setTimer(1)">1m</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- WORK LOG Panel -->
  <div id="log" class="panel">
    <div class="card">
      <h2>Work Log</h2>
      <div id="workLogList"></div>
    </div>
  </div>

  <!-- TASKS Panel -->
  <div id="tasks" class="panel">
    <div class="card">
      <h2>Priority Tasks</h2>
      <p style="color: #888; font-size: 13px; margin-bottom: 15px;">Drag to reorder by priority</p>
      <div style="display: grid; grid-template-columns: 1fr auto auto; gap: 10px; margin-bottom: 15px;">
        <input id="newTask" placeholder="New task..." style="margin: 0;">
        <select id="newTaskPriority" style="width: 120px; margin: 0;">
          <option value="high">High</option>
          <option value="medium" selected>Medium</option>
          <option value="low">Low</option>
        </select>
        <button class="btn" style="margin: 0;" onclick="addTask()">Add</button>
      </div>
      <div id="taskList"></div>
    </div>
  </div>
</div>

<!-- Schedule Modal -->
<div id="scheduleModal" class="modal">
  <div class="modal-content">
    <h3>Edit Weekly Schedule</h3>
    <p style="color: #888; font-size: 13px; margin-bottom: 15px;">Format: Time - Class Name - Location (one per line)</p>
    
    <div id="scheduleEditor">
      <div class="schedule-day">
        <h4>Monday</h4>
        <textarea id="schedule-Monday" rows="3" placeholder="9:00 - Introduction to Philosophy - Room 301&#10;14:00 - Mathematics - Building A"></textarea>
      </div>
      <div class="schedule-day">
        <h4>Tuesday</h4>
        <textarea id="schedule-Tuesday" rows="3" placeholder="9:00 - Introduction to Philosophy - Room 301"></textarea>
      </div>
      <div class="schedule-day">
        <h4>Wednesday</h4>
        <textarea id="schedule-Wednesday" rows="3" placeholder="9:00 - Introduction to Philosophy - Room 301"></textarea>
      </div>
      <div class="schedule-day">
        <h4>Thursday</h4>
        <textarea id="schedule-Thursday" rows="3" placeholder="9:00 - Introduction to Philosophy - Room 301"></textarea>
      </div>
      <div class="schedule-day">
        <h4>Friday</h4>
        <textarea id="schedule-Friday" rows="3" placeholder="9:00 - Introduction to Philosophy - Room 301"></textarea>
      </div>
    </div>
    
    <button class="btn" onclick="saveSchedule()">Save Schedule</button>
    <button class="btn btn-ghost" onclick="closeModal('scheduleModal')">Cancel</button>
  </div>
</div>

<script>
const store = {
  get(k, def) {
    try { return JSON.parse(localStorage.getItem(k)) || def; } catch { return def; }
  },
  set(k, v) { localStorage.setItem(k, JSON.stringify(v)); }
};

let timerInterval = null;
let timerSeconds = 25 * 60;
let timerRunning = false;

function showTab(tab) {
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.tabs button').forEach(b => b.classList.remove('active'));
  document.getElementById(tab).classList.add('active');
  event.target.classList.add('active');
}

function openModal(id) {
  document.getElementById(id).classList.add('open');
  if (id === 'scheduleModal') loadScheduleEditor();
}

function closeModal(id) {
  document.getElementById(id).classList.remove('open');
}

// Schedule functions
function loadScheduleEditor() {
  const schedule = store.get('work.schedule', {});
  ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'].forEach(day => {
    document.getElementById(`schedule-${day}`).value = schedule[day] || '';
  });
}

function saveSchedule() {
  const schedule = {};
  ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'].forEach(day => {
    schedule[day] = document.getElementById(`schedule-${day}`).value;
  });
  store.set('work.schedule', schedule);
  closeModal('scheduleModal');
  renderTodayClasses();
}

function renderTodayClasses() {
  const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
  const today = days[new Date().getDay()];
  document.getElementById('todayDate').textContent = today;
  
  const schedule = store.get('work.schedule', {});
  const todaySchedule = schedule[today] || '';
  
  if (!todaySchedule.trim()) {
    document.getElementById('todayClasses').innerHTML = '<p style="color:#888">No classes today. Click "Edit Schedule" to add your weekly classes.</p>';
    return;
  }
  
  const classes = todaySchedule.split('\n').filter(line => line.trim());
  const html = classes.map((classLine, i) => {
    const parts = classLine.split(' - ');
    const time = parts[0] || '';
    const name = parts[1] || classLine;
    const location = parts[2] || '';
    
    const savedNotes = store.get('work.classNotes', {});
    const noteKey = `${new Date().toISOString().slice(0,10)}-${i}`;
    const notes = savedNotes[noteKey] || '';
    
    return `
      <div class="class-item">
        <div class="class-time">${time}</div>
        <div class="class-name">${name}</div>
        ${location ? `<div class="class-location">${location}</div>` : ''}
        <div class="class-notes">
          <textarea placeholder="Take notes..." onchange="saveClassNotes(${i}, this.value, '${name}')">${notes}</textarea>
        </div>
      </div>
    `;
  }).join('');
  
  document.getElementById('todayClasses').innerHTML = html;
}

function saveClassNotes(classIndex, notes, className) {
  const savedNotes = store.get('work.classNotes', {});
  const noteKey = `${new Date().toISOString().slice(0,10)}-${classIndex}`;
  savedNotes[noteKey] = notes;
  store.set('work.classNotes', savedNotes);
  
  // Add to work log
  const workLog = store.get('work.log', []);
  const existingIndex = workLog.findIndex(entry => entry.noteKey === noteKey);
  
  if (existingIndex >= 0) {
    workLog[existingIndex].notes = notes;
    workLog[existingIndex].timestamp = new Date().toISOString();
  } else if (notes.trim()) {
    workLog.unshift({
      noteKey,
      date: new Date().toISOString(),
      timestamp: new Date().toISOString(),
      className,
      notes
    });
  }
  
  store.set('work.log', workLog);
}

function renderWorkLog() {
  const workLog = store.get('work.log', []).filter(entry => entry.notes && entry.notes.trim());
  if (workLog.length === 0) {
    document.getElementById('workLogList').innerHTML = '<p style="color:#888">No entries yet. Take notes in your classes to see them here.</p>';
    return;
  }
  
  const html = workLog.map((entry, i) => `
    <div class="work-log-entry">
      <div class="work-log-header">
        <div>
          <div class="work-log-date">${new Date(entry.date).toLocaleDateString(undefined, { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' })}</div>
          <div class="work-log-class">${entry.className}</div>
        </div>
        <button class="btn btn-sm btn-ghost" onclick="deleteLogEntry('${entry.noteKey}')">×</button>
      </div>
      <div class="work-log-notes">${entry.notes}</div>
    </div>
  `).join('');
  
  document.getElementById('workLogList').innerHTML = html;
}

function deleteLogEntry(noteKey) {
  if (!confirm('Delete this log entry?')) return;
  const workLog = store.get('work.log', []);
  const filtered = workLog.filter(entry => entry.noteKey !== noteKey);
  store.set('work.log', filtered);
  renderWorkLog();
}

// Task functions
function addTask() {
  const text = document.getElementById('newTask').value.trim();
  if (!text) return;
  
  const priority = document.getElementById('newTaskPriority').value;
  const tasks = store.get('work.tasks', []);
  tasks.push({ text, priority, done: false, id: Date.now() });
  store.set('work.tasks', tasks);
  document.getElementById('newTask').value = '';
  renderTasks();
}

function renderTasks() {
  const tasks = store.get('work.tasks', []);
  if (tasks.length === 0) {
    document.getElementById('taskList').innerHTML = '<p style="color:#888">No tasks yet. Add your first task above.</p>';
    return;
  }
  
  const html = tasks.map((task, i) => `
    <div class="task-item priority-${task.priority} ${task.done ? 'done' : ''}" draggable="true" data-index="${i}">
      <span class="drag-handle">☰</span>
      <input type="checkbox" ${task.done ? 'checked' : ''} onchange="toggleTask(${i})">
      <span class="task-text">${task.text}</span>
      <span style="font-size: 11px; color: #888; text-transform: uppercase; flex-shrink: 0;">${task.priority}</span>
      <button class="btn btn-sm btn-ghost" style="padding: 4px 8px;" onclick="deleteTask(${i})">×</button>
    </div>
  `).join('');
  
  document.getElementById('taskList').innerHTML = html;
  setupDragAndDrop();
}

function toggleTask(i) {
  const tasks = store.get('work.tasks', []);
  tasks[i].done = !tasks[i].done;
  store.set('work.tasks', tasks);
  renderTasks();
}

function deleteTask(i) {
  const tasks = store.get('work.tasks', []);
  tasks.splice(i, 1);
  store.set('work.tasks', tasks);
  renderTasks();
}

function setupDragAndDrop() {
  const items = document.querySelectorAll('.task-item');
  let draggedItem = null;
  
  items.forEach(item => {
    item.addEventListener('dragstart', function(e) {
      draggedItem = this;
      this.classList.add('dragging');
      e.dataTransfer.effectAllowed = 'move';
    });
    
    item.addEventListener('dragend', function() {
      this.classList.remove('dragging');
      const tasks = store.get('work.tasks', []);
      const newOrder = [];
      document.querySelectorAll('.task-item').forEach(el => {
        const index = parseInt(el.dataset.index);
        newOrder.push(tasks[index]);
      });
      store.set('work.tasks', newOrder);
      renderTasks();
    });
    
    item.addEventListener('dragover', function(e) {
      e.preventDefault();
      const afterElement = getDragAfterElement(document.getElementById('taskList'), e.clientY);
      const container = document.getElementById('taskList');
      if (afterElement == null) {
        container.appendChild(draggedItem);
      } else {
        container.insertBefore(draggedItem, afterElement);
      }
    });
  });
}

function getDragAfterElement(container, y) {
  const draggableElements = [...container.querySelectorAll('.task-item:not(.dragging)')];
  
  return draggableElements.reduce((closest, child) => {
    const box = child.getBoundingClientRect();
    const offset = y - box.top - box.height / 2;
    
    if (offset < 0 && offset > closest.offset) {
      return { offset: offset, element: child };
    } else {
      return closest;
    }
  }, { offset: Number.NEGATIVE_INFINITY }).element;
}

// Timer functions
function setTimer(minutes) {
  timerSeconds = minutes * 60;
  updateTimerDisplay();
}

function startTimer() {
  if (timerRunning) return;
  timerRunning = true;
  document.getElementById('timerStart').style.display = 'none';
  document.getElementById('timerPause').style.display = 'inline-block';
  
  timerInterval = setInterval(() => {
    timerSeconds--;
    updateTimerDisplay();
    
    if (timerSeconds <= 0) {
      pauseTimer();
      if (Notification.permission === 'granted') {
        new Notification('Timer Complete!', { body: 'Time\'s up!' });
      } else {
        alert('Time\'s up!');
      }
      timerSeconds = 25 * 60;
      updateTimerDisplay();
    }
  }, 1000);
}

function pauseTimer() {
  timerRunning = false;
  clearInterval(timerInterval);
  document.getElementById('timerStart').style.display = 'inline-block';
  document.getElementById('timerPause').style.display = 'none';
}

function resetTimer() {
  pauseTimer();
  timerSeconds = 25 * 60;
  updateTimerDisplay();
}

function updateTimerDisplay() {
  const mins = Math.floor(timerSeconds / 60);
  const secs = timerSeconds % 60;
  document.getElementById('timerDisplay').textContent = 
    `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
}

function exportData() {
  const data = {
    schedule: store.get('work.schedule', {}),
    workLog: store.get('work.log', []),
    tasks: store.get('work.tasks', []),
    classNotes: store.get('work.classNotes', {}),
    exportDate: new Date().toISOString()
  };
  const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `work-backup-${new Date().toISOString().slice(0,10)}.json`;
  a.click();
  URL.revokeObjectURL(url);
}

// Request notification permission
if (Notification.permission === 'default') {
  Notification.requestPermission();
}

// Initialize
renderTodayClasses();
renderWorkLog();
renderTasks();
updateTimerDisplay();
</script>

</body>
</html>
