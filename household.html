<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Household Control</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  *{box-sizing:border-box;margin:0;padding:0}
  body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Arial,sans-serif;background:#1a1a1a;color:#e8e8e8}
  .top-nav{background:#161616;padding:10px 20px;display:flex;gap:15px;border-bottom:1px solid #333}
  .top-nav a{color:#9aa0a6;text-decoration:none;padding:8px 14px;border-radius:6px}
  .top-nav a:hover,.top-nav a.active{background:#2a2a2a;color:#4aa3ff}
  .container{max-width:1100px;margin:0 auto;padding:22px}
  header{background:#212121;border:1px solid #2c2c2c;padding:18px 20px;border-radius:10px;margin-bottom:18px}
  header h1{font-size:22px;margin-bottom:6px}
  header p{font-size:13px;color:#9aa0a6}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:14px}
  .card{background:#252525;border:1px solid #2f2f2f;border-radius:10px;padding:18px}
  .card h2{font-size:15px;margin-bottom:10px}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  label.small{font-size:12px;color:#9aa0a6}
  input,select,button,textarea{background:#2b2b2b;border:1px solid #3a3a3a;color:#e8e8e8;padding:10px;border-radius:8px;font-size:14px}
  input:focus,textarea:focus,select:focus{outline:none;border-color:#4aa3ff}
  .muted{color:#9aa0a6;font-size:12px}
  .amt{font-size:26px;font-weight:700;color:#4aa3ff}
  .sub{font-size:12px;color:#b0b0b0}
  .btn{background:#4aa3ff;border:none;color:#fff;cursor:pointer;padding:8px 14px;border-radius:8px}
  .btn:hover{background:#398ff0}
  .btn-ghost{background:transparent;border:1px solid #4aa3ff;color:#e8e8e8;padding:8px 14px;border-radius:8px}
  .kpi{display:flex;flex-direction:column;gap:4px}
  .kpi .title{font-size:12px;color:#9aa0a6}
  .kpi .value{font-size:22px;font-weight:700}
  .pill{display:inline-block;padding:4px 8px;border-radius:999px;font-size:11px;border:1px solid #3a3a3a;color:#9aa0a6}
  .spacer{height:8px}
  .divider{height:1px;background:#333;margin:12px 0}
  details{background:#232323;border:1px solid #2f2f2f;border-radius:10px;padding:12px}
  details summary{cursor:pointer;color:#cfcfcf;margin-bottom:6px}
  .list{display:flex;flex-direction:column;gap:10px;max-height:320px;overflow:auto}
  .log{background:#2b2b2b;border:1px solid #363636;border-radius:8px;padding:10px}
  .log .when{font-size:12px;color:#9aa0a6;margin-bottom:4px}
</style>
</head>
<body>

<!-- NAV -->
<div class="top-nav">
  <a href="index.html">← Hub</a>
  <a href="walks.html">Walks</a>
  <a href="work.html">Work</a>
  <a href="business.html">Business</a>
  <a href="leverage.html">Leverage</a>
  <a class="active" href="household.html">Household</a>
</div>

<div class="container">
  <header>
    <h1>Household Control</h1>
    <p>Split income, track balances, and see the rhythm of independence.</p>
  </header>

  <!-- SPLIT INPUT -->
  <div class="grid">
    <div class="card">
      <h2>Income & Split</h2>
      <label class="small">Monthly household income</label>
      <input id="income" type="number" step="100" value="13500"/>
      <div class="divider"></div>
      <div class="grid" style="grid-template-columns:1fr 1fr">
        <div class="kpi"><div class="title">Living (55%)</div><div class="value amt" id="amtOps">$7,425</div><div class="sub" id="amtOpsWk">≈ /wk</div></div>
        <div class="kpi"><div class="title">Debt + Buffer (25%)</div><div class="value amt" id="amtBuf">$3,375</div><div class="sub" id="amtBufWk">≈ /wk</div></div>
        <div class="kpi"><div class="title">Growth + Tools (10%)</div><div class="value amt" id="amtGrowth">$1,350</div><div class="sub" id="amtGrowthWk">≈ /wk</div></div>
        <div class="kpi"><div class="title">Freedom (10%)</div><div class="value amt" id="amtFreedom">$1,350</div><div class="sub" id="amtFreedomWk">≈ /wk</div></div>
      </div>
      <div class="spacer"></div>
      <button class="btn" id="saveIncome">Save split</button>
    </div>
  </div>

  <div class="spacer"></div>

  <!-- BALANCES + GRAPH -->
  <div class="card">
    <h2>Current Balances</h2>
    <p class="muted">Enter balances from each account to compare against targets.</p>
    <div class="grid" style="grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px;">
      <div><label class="small">Living</label><input id="balOps" type="number" step="100" placeholder="e.g. 7400"></div>
      <div><label class="small">Debt + Buffer</label><input id="balBuf" type="number" step="100" placeholder="e.g. 3300"></div>
      <div><label class="small">Growth + Tools</label><input id="balGrowth" type="number" step="100" placeholder="e.g. 1350"></div>
      <div><label class="small">Freedom</label><input id="balFreedom" type="number" step="100" placeholder="e.g. 1350"></div>
    </div>
    <div class="spacer"></div>
    <button class="btn" id="saveBalances">Save Balances</button>
    <span class="pill" id="balStatus">—</span>
    <div class="spacer"></div>
    <canvas id="balanceChart" style="width:100%;max-width:700px;height:260px;background:#1a1a1a;border-radius:8px;"></canvas>
  </div>

</div>

<script>
/* ---------- Local storage helpers ---------- */
const store = {
  get: (k, def=null) => { try{ const v = localStorage.getItem(k); return v ? JSON.parse(v) : def } catch{ return def } },
  set: (k, v) => localStorage.setItem(k, JSON.stringify(v))
};
const el = id => document.getElementById(id);

/* ---------- Income ---------- */
const incomeInput = el('income');
const saveIncomeBtn = el('saveIncome');
const amtOps = el('amtOps'), amtBuf = el('amtBuf'), amtGrowth = el('amtGrowth'), amtFreedom = el('amtFreedom');
const amtOpsWk = el('amtOpsWk'), amtBufWk = el('amtBufWk'), amtGrowthWk = el('amtGrowthWk'), amtFreedomWk = el('amtFreedomWk');
const fmt = n => n.toLocaleString(undefined,{style:'currency',currency:'AUD',maximumFractionDigits:0});
const weeklyFromMonthly = m => Math.round(m / 4.345);
let targets = {ops:0,buf:0,growth:0,freedom:0};

function renderSplit(income){
  targets.ops = Math.round(income * 0.55);
  targets.buf = Math.round(income * 0.25);
  targets.growth = Math.round(income * 0.10);
  targets.freedom = Math.round(income * 0.10);

  amtOps.textContent = fmt(targets.ops);
  amtBuf.textContent = fmt(targets.buf);
  amtGrowth.textContent = fmt(targets.growth);
  amtFreedom.textContent = fmt(targets.freedom);

  amtOpsWk.textContent = '≈ ' + fmt(weeklyFromMonthly(targets.ops)) + '/wk';
  amtBufWk.textContent = '≈ ' + fmt(weeklyFromMonthly(targets.buf)) + '/wk';
  amtGrowthWk.textContent = '≈ ' + fmt(weeklyFromMonthly(targets.growth)) + '/wk';
  amtFreedomWk.textContent = '≈ ' + fmt(weeklyFromMonthly(targets.freedom)) + '/wk';
}
function loadIncome(){
  const val = store.get('house.income',13500);
  incomeInput.value = val;
  renderSplit(val);
}
saveIncomeBtn.addEventListener('click',()=>{
  const val = Number(incomeInput.value)||13500;
  store.set('house.income', val);
  renderSplit(val);
  updateChart();
  saveIncomeBtn.textContent='Saved';
  setTimeout(()=>saveIncomeBtn.textContent='Save split',800);
});

/* ---------- Balances ---------- */
const balOps = el('balOps'), balBuf = el('balBuf'), balGrowth = el('balGrowth'), balFreedom = el('balFreedom');
const saveBalancesBtn = el('saveBalances'), balStatus = el('balStatus');
let chart;

function loadBalances(){
  const b = store.get('house.balances',{ops:0,buf:0,growth:0,freedom:0});
  balOps.value = b.ops || '';
  balBuf.value = b.buf || '';
  balGrowth.value = b.growth || '';
  balFreedom.value = b.freedom || '';
  updateChart();
}
function updateChart(){
  const b = store.get('house.balances',{ops:0,buf:0,growth:0,freedom:0});
  const ctx = document.getElementById('balanceChart').getContext('2d');
  const actual = [b.ops,b.buf,b.growth,b.freedom];
  const target = [targets.ops,targets.buf,targets.growth,targets.freedom];
  const labels = ['Living','Debt+Buffer','Growth+Tools','Freedom'];
  const colorsA = '#4aa3ff', colorsT = '#9aa0a6';
  if(chart) chart.destroy();
  chart = new Chart(ctx,{
    type:'bar',
    data:{
      labels,
      datasets:[
        {label:'Actual',data:actual,backgroundColor:colorsA,borderRadius:6},
        {label:'Target',data:target,backgroundColor:colorsT,borderRadius:6}
      ]
    },
    options:{
      scales:{
        y:{beginAtZero:true,grid:{color:'#333'},ticks:{color:'#999'}},
        x:{grid:{display:false},ticks:{color:'#ccc'}}
      },
      plugins:{legend:{labels:{color:'#ccc'}}}
    }
  });
}
saveBalancesBtn.addEventListener('click',()=>{
  const b={ops:Number(balOps.value)||0,buf:Number(balBuf.value)||0,growth:Number(balGrowth.value)||0,freedom:Number(balFreedom.value)||0};
  store.set('house.balances',b);
  updateChart();
  balStatus.textContent='Saved '+new Date().toLocaleTimeString();
});

/* ---------- Init ---------- */
loadIncome();
loadBalances();
</script>
</body>
</html>
