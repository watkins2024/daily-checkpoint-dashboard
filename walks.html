<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Walks & Reflection</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif; background: #1a1a1a; color: #e0e0e0; }
    
    .top-nav { background: #161616; padding: 10px 20px; display: flex; gap: 15px; border-bottom: 1px solid #333; }
    .top-nav a { color: #888; text-decoration: none; padding: 8px 16px; border-radius: 6px; transition: all 0.2s; }
    .top-nav a:hover { background: #2a2a2a; color: #4a9eff; }
    .top-nav a.active { background: #2a2a2a; color: #4a9eff; }
    
    .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
    header { background: #222; padding: 15px 20px; margin-bottom: 20px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; }
    header h1 { font-size: 24px; }
    
    .btn { background: #4a9eff; color: #fff; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 14px; margin: 5px; transition: background 0.2s; text-decoration: none; display: inline-block; }
    .btn:hover { background: #3a8eef; }
    .btn-ghost { background: transparent; border: 1px solid #4a9eff; }
    
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
    @media (max-width: 768px) { .grid { grid-template-columns: 1fr; } }
    
    .card { background: #2a2a2a; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.3); }
    .card h2 { font-size: 18px; margin-bottom: 15px; color: #fff; }
    
    .moon-display { text-align: center; padding: 30px; }
    .moon-icon { font-size: 80px; margin: 20px 0; }
    .moon-phase { font-size: 24px; font-weight: 600; margin-bottom: 10px; }
    .moon-illumination { color: #888; }
    
    input, select, textarea { background: #333; border: 1px solid #444; color: #e0e0e0; padding: 10px; border-radius: 6px; width: 100%; margin-bottom: 10px; font-size: 14px; }
    input:focus, select:focus, textarea:focus { outline: none; border-color: #4a9eff; }
    
    .walk-entry { background: #333; padding: 15px; border-radius: 6px; margin-bottom: 10px; }
    .walk-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
    .walk-date { font-weight: 600; }
    .walk-meta { color: #999; font-size: 13px; margin: 5px 0; }
    .walk-notes { margin-top: 10px; line-height: 1.6; }
    
    .streak-display { text-align: center; padding: 20px; }
    .streak-number { font-size: 48px; font-weight: 600; color: #4a9eff; }
    .streak-label { color: #888; margin-top: 10px; }
    
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center; }
    .modal.open { display: flex; }
    .modal-content { background: #2a2a2a; padding: 30px; border-radius: 12px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto; }
    .modal-content h3 { margin-bottom: 20px; }
  </style>
</head>
<body>

<div class="top-nav">
  <a href="index.html">‚Üê Hub</a>
  <a href="walks.html" class="active">Walks</a>
  <a href="work.html">Work</a>
  <a href="business.html">Business</a>
</div>

<header>
  <h1>Walks & Reflection</h1>
  <div>
    <button class="btn" onclick="openModal('walkModal')">Log Walk</button>
    <button class="btn btn-ghost" onclick="exportData()">Export to Drive</button>
  </div>
</header>

<div class="container">
  <div class="grid">
    <div class="card">
      <h2>Current Moon Phase</h2>
      <div class="moon-display">
        <div class="moon-icon" id="moonIcon">üåï</div>
        <div class="moon-phase" id="moonPhase">Full Moon</div>
        <div class="moon-illumination" id="moonIllumination">100% illuminated</div>
        <div style="margin-top: 20px; color: #888; font-size: 12px;" id="moonDate"></div>
      </div>
    </div>

    <div class="card">
      <h2>Walk Streak</h2>
      <div class="streak-display">
        <div class="streak-number" id="streakNumber">0</div>
        <div class="streak-label">consecutive days</div>
        <div style="margin-top: 20px; color: #888; font-size: 14px;">
          Last walk: <span id="lastWalkDate">Never</span>
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <h2>Walk Log</h2>
    <div id="walkList"></div>
  </div>
</div>

<div id="walkModal" class="modal">
  <div class="modal-content">
    <h3>Log Dawn Walk</h3>
    <input id="wmLocation" placeholder="Location (e.g., coast / north west)">
    <select id="wmWeather">
      <option>Cold</option><option>Wind</option><option>Cloud</option><option>Clear</option><option>Rain</option>
    </select>
    <select id="wmMood">
      <option>Calm</option><option>Charged</option><option>Focused</option><option>Ragged</option>
    </select>
    <div style="display: flex; gap: 20px; margin: 10px 0;">
      <label style="display: flex; align-items: center; gap: 5px;">
        <input id="wmStar" type="checkbox">
        <span>Star sip</span>
      </label>
      <label style="display: flex; align-items: center; gap: 5px;">
        <input id="wmSalt" type="checkbox">
        <span>Salted</span>
      </label>
    </div>
    <textarea id="wmNotes" rows="6" placeholder="Notes (gestures, shadow path, fox/possum, magpie before light, processing thoughts...)"></textarea>
    <button class="btn" onclick="saveWalk()">Save</button>
    <button class="btn btn-ghost" onclick="closeModal('walkModal')">Cancel</button>
  </div>
</div>

<script>
const store = {
  get(k, def) {
    try { return JSON.parse(localStorage.getItem(k)) || def; } catch { return def; }
  },
  set(k, v) { localStorage.setItem(k, JSON.stringify(v)); }
};

function openModal(id) {
  document.getElementById(id).classList.add('open');
}

function closeModal(id) {
  document.getElementById(id).classList.remove('open');
}

function getMoonPhase() {
  const now = new Date();
  const year = now.getFullYear();
  const month = now.getMonth() + 1;
  const day = now.getDate();
  
  let c = 0, e = 0, jd = 0, b = 0;
  
  if (month < 3) {
    year--;
    month += 12;
  }
  
  ++month;
  c = 365.25 * year;
  e = 30.6 * month;
  jd = c + e + day - 694039.09;
  jd /= 29.5305882;
  b = parseInt(jd);
  jd -= b;
  b = Math.round(jd * 8);
  
  if (b >= 8) b = 0;
  
  const phases = [
    { name: 'New Moon', icon: 'üåë', illumination: '0%' },
    { name: 'Waxing Crescent', icon: 'üåí', illumination: '25%' },
    { name: 'First Quarter', icon: 'üåì', illumination: '50%' },
    { name: 'Waxing Gibbous', icon: 'üåî', illumination: '75%' },
    { name: 'Full Moon', icon: 'üåï', illumination: '100%' },
    { name: 'Waning Gibbous', icon: 'üåñ', illumination: '75%' },
    { name: 'Last Quarter', icon: 'üåó', illumination: '50%' },
    { name: 'Waning Crescent', icon: 'üåò', illumination: '25%' }
  ];
  
  const phase = phases[b];
  document.getElementById('moonIcon').textContent = phase.icon;
  document.getElementById('moonPhase').textContent = phase.name;
  document.getElementById('moonIllumination').textContent = phase.illumination + ' illuminated';
  document.getElementById('moonDate').textContent = now.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
}

function saveWalk() {
  const walks = store.get('fh.walks', []);
  walks.unshift({
    date: new Date().toISOString(),
    location: document.getElementById('wmLocation').value || '‚Äî',
    weather: document.getElementById('wmWeather').value,
    mood: document.getElementById('wmMood').value,
    star: document.getElementById('wmStar').checked,
    salt: document.getElementById('wmSalt').checked,
    notes: document.getElementById('wmNotes').value,
    moonPhase: document.getElementById('moonPhase').textContent
  });
  store.set('fh.walks', walks);
  document.getElementById('wmLocation').value = '';
  document.getElementById('wmNotes').value = '';
  document.getElementById('wmStar').checked = false;
  document.getElementById('wmSalt').checked = false;
  closeModal('walkModal');
  renderWalks();
  updateStreak();
}

function renderWalks() {
  const walks = store.get('fh.walks', []);
  if (walks.length === 0) {
    document.getElementById('walkList').innerHTML = '<p style="color:#888">No walks logged yet.</p>';
    document.getElementById('lastWalkDate').textContent = 'Never';
    return;
  }
  
  const latest = walks[0];
  document.getElementById('lastWalkDate').textContent = new Date(latest.date).toLocaleDateString();
  
  const html = walks.map((w, i) => `
    <div class="walk-entry">
      <div class="walk-header">
        <div class="walk-date">${new Date(w.date).toLocaleString()}</div>
        <button class="btn btn-ghost" style="padding: 4px 8px; font-size: 12px;" onclick="deleteWalk(${i})">√ó</button>
      </div>
      <div class="walk-meta">${w.location} ¬∑ ${w.weather} ¬∑ ${w.mood}${w.star ? ' ¬∑ star sip' : ''}${w.salt ? ' ¬∑ salted' : ''} ¬∑ ${w.moonPhase || ''}</div>
      <div class="walk-notes">${w.notes}</div>
    </div>
  `).join('');
  document.getElementById('walkList').innerHTML = html;
}

function deleteWalk(i) {
  if (!confirm('Delete this walk entry?')) return;
  const walks = store.get('fh.walks', []);
  walks.splice(i, 1);
  store.set('fh.walks', walks);
  renderWalks();
  updateStreak();
}

function updateStreak() {
  const walks = store.get('fh.walks', []);
  const days = new Set(walks.map(w => w.date.slice(0, 10)));
  let streak = 0;
  let d = new Date();
  
  while (days.has(d.toISOString().slice(0, 10))) {
    streak++;
    d.setDate(d.getDate() - 1);
  }
  
  document.getElementById('streakNumber').textContent = streak;
}

function exportData() {
  const data = {
    walks: store.get('fh.walks', []),
    exportDate: new Date().toISOString()
  };
  const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `walks-backup-${new Date().toISOString().slice(0,10)}.json`;
  a.click();
  URL.revokeObjectURL(url);
}

getMoonPhase();
renderWalks();
updateStreak();
</script>

</body>
</html>
